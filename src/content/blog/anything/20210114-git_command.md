---
# lang: zh-TW
# head:
title: git æŒ‡ä»¤ç²¾é¸
description: interactive rebase --autostash --autosquash, commit --fixup:amend, merge --no-ff, --no-commit,
date: 2021-01-14
---

# å¥½ç”¨çš„ã€æ–¹ä¾¿çš„ git command

ç´€éŒ„å¹¾å€‹æˆ‘å€‹äºº**éå¸¸**å¸¸ç”¨çš„ git commandã€vscode æ“ä½œã€‚
é¡å¤–èŠ±äº†æ™‚é–“å¾ git doc, vscode doc è£¡é¢æŒ–æ˜é€™äº›æŒ‡ä»¤ã€æ“ä½œéå¸¸å€¼å¾—ï¼Œ
åˆ†äº«å‡ºä¾†ã€‚

[[toc]]

## `-h` / `--help`

ç¬¬ä¸€å€‹è‚¯å®šè¦åˆ—é€™å€‹çš„ï¼Œ
å¾ˆå¤šåœ°æ–¹å¾ˆå¤šæƒ…æ³éƒ½å¯ä»¥ `git -h`, `git add -h`, `git rebase -h`ï¼Œ
æƒ³è¦ç²å¾—ä»€éº¼èªªæ˜çš„æœ€å¿«æ–¹å¼ã€‚

## `git add -u`

ç”¨é€”: æŠŠå·²ç¶“**è¢«è¿½è¹¤**çš„ä¿®æ”¹ï¼ŒåŠ åˆ° staging

å¦‚æœä¸€æ¬¡ä¿®æ”¹äº†ä¸å°‘æª”æ¡ˆã€è€Œä¸”éƒ½æ˜¯è¦åŠ åˆ°é€™æ¬¡ commit çš„ï¼Œ
æˆ‘æœƒä½¿ç”¨ `git add -u` è€Œä¸æ˜¯ `git add -A`ï¼Œ
åŸå› æ˜¯æˆ‘è‡ªå·±å¶çˆ¾æœƒå¯«ä¸€äº›å¾ˆç°¡å–®ã€å–®ç´”çš„æ¸¬è©¦ã€é©—è­‰è‡ªå·±çš„æƒ³æ³•å°ä¸å°çš„æª”æ¡ˆï¼Œ
é€™äº›æª”æ¡ˆç‹€æ…‹æ˜¯ **Untracked**ï¼Œ

![](./images/02-1.png)

å¦‚æœæ˜¯ `git add -A` å°±æœƒä¸€ä½µæŠŠ Untracked çš„æª”æ¡ˆåŠ é€²å»äº†ã€‚

## `git commit --amend`

ç”¨é€”: æŠŠ staging çš„æ±è¥¿ä¿®æ”¹åˆ°ä¸Šä¸€æ¬¡çš„ commitã€‚

å¸¸å¸¸æœƒä¸å°å¿ƒæŠŠä¸è©² commit é€²å»çš„ç¨‹å¼ç¢¼ã€æª”æ¡ˆä¸å°å¿ƒåŠ åˆ°é€™æ¬¡çš„ commit è£¡é¢å»ï¼Œ
æˆ–è€…ä¸å°å¿ƒæ¼æ‰å¹¾å¥ç¨‹å¼ç¢¼ã€æª”æ¡ˆè¦ commitï¼Œ
é€™æ™‚å€™å¯ä»¥ä½¿ç”¨é€™å€‹ï¼Œç›´æ¥åŠ åˆ°ä¸Šä¸€æ¬¡åˆ° commitã€‚

å¦‚æœ commit message æ²’æœ‰è¦ä¿®æ”¹ï¼Œåªæ˜¯ä¿®æ”¹å…§å®¹çš„è©±ï¼Œå¯ä»¥å†åŠ ä¸Š `--no-edit`
è®Šæˆ

```
git commit --amend --no-edit
```

## é€£çºŒæŠ€: `git commit --fixup=amend:<commit hash>` + `git rebase -i --autosquash --autostash`

ç”¨é€”: ç”¢å‡ºä¸€å€‹æ–°çš„ã€æœ‰æ¨™è¨˜çš„ commitï¼Œåœ¨ git rebase æ™‚ï¼Œgit æœƒèªå¾—é€™å€‹æ¨™è¨˜ï¼Œç„¶å¾ŒæŠŠå®ƒæ”¾åˆ°æ­£ç¢ºçš„ä½ç½®ä¸Šã€‚

:::warning æº«é¦¨å°æé†’
ä¸‹é¢æ‰€æœ‰ git tree æ˜¯è‡ªå®šç¾©çš„ `git log` aliasï¼Œ
å–œæ­¡çš„è©±å¯ä»¥è‡ªå·±æ‹¿å»æ”¹ï¼Œæˆ‘ä¹Ÿæ˜¯å¾ [Chris](https://dwatow.github.io/) å¤§å¤§é‚£è£¡å·ä¾†çš„

```
alias.tree=log -20 --pretty=format:"%h - %Cblue%an%Creset, %Cgreen%ad%Creset, %Cred%ar%Creset : %s %C(auto)%d %w(0,6,6)%+b" --graph --date=format:"%m/%d %H:%M"
```

è‡³æ–¼åƒæ•¸è©²æ€éº¼æ”¾ï¼Œè«‹åƒé–± [git scm - pretty-formats](https://git-scm.com/docs/pretty-formats)
è€Œ `git commit --fixup=amend` ä¹Ÿå¾ˆé•·
é™„ä¸Šæˆ‘çš„ alias

```
alias.fixup=!f() { git commit --fixup=amend:$1; }; f
```

:::

![](./images/2022-01-14-01-25-10.png)

å‡è¨­æˆ‘çš„ git log é•·é€™æ¨£ï¼Œç„¶å¾Œçªç„¶ç™¼ç¾æœ‰æ±è¥¿å¿˜è¨˜åŠ é€²å» b276d3b é€™å€‹ commitï¼Œ
ä½†æ˜¯ç™¼ç¾æ™‚å·²ç¶“åˆå¤šäº†å››å€‹ commitï¼Œ
é€™æ™‚å€™å·²ç¶“æ²’è¾¦æ³•ä½¿ç”¨ `git commit --amend` äº†ï¼Œ
reset å›å»å†æ…¢æ…¢é‡è¤‡å‰›å‰›çš„ commit çµ•å°æ˜¯æµªè²»ç”Ÿå‘½çš„è¡Œç‚ºã€‚

é€™æ™‚å€™è«‹ä½¿ç”¨ `git commit --fixup=amend:b276d3b` + `git rebase -i --autosquash`
é€™å€‹**é€£çºŒæŠ€**
![](./images/2022-01-14-01-26-25.png)

(é †å¸¶ä¸€æ `git commit --allow-empty` å°±å¯ä»¥è£½é€ å‡º æ²’æœ‰ä»»ä½•ä¿®æ”¹çš„ commitï¼Œåœ¨æ•™å­¸æ™‚å¾ˆå¥½ç”¨ XD)

![](./images/2022-01-14-01-27-18.png)

ä¸€æ¨£åƒæ˜¯ commit çš„æµç¨‹ï¼Œåªæ˜¯é€™æ¬¡ git æœƒå¾ˆè²¼å¿ƒçš„å…ˆå¹«ä½ æŠŠç›¸é—œè¨»è§£æ‰“å¥½ï¼Œ
è®“ä½ çŸ¥é“é€™å€‹ commit æ˜¯è¦ç”¨ä¾†ä¿®æ”¹ä¹‹å‰ commit çš„ commit

![](./images/2022-01-14-01-28-01.png)

`git rebase -i --autosquash`ï¼Œçµ¦ä»– Enter ä¸‹å»ã€‚

![](./images/2022-01-14-01-29-03.png)

å‰›å‰›é‚£å€‹ fixup çš„ commit æœƒè‡ªå‹•é£›åˆ°æŒ‡å®šçš„ commit hash(b276d3b)ä¸‹é¢ï¼Œ
ä½ åªè¦è¼•è¼•åœ° å„²å­˜ã€é€€å‡ºï¼ŒAll Done!!

![](./images/2022-01-14-01-31-45.png)

å†æ¬¡ `git log`ï¼Œå¯ä»¥çœ‹åˆ°å‰›å‰›çš„ b276d3b å·²ç¶“è¢«é‡ç®—éï¼Œä¿®æ”¹å·²ç¶“åŠ é€²å»äº†~

æˆ‘è‡ªå·±é‚„æœƒå†åŠ ä¸Š `--autostash`ï¼Œ
å¯ä»¥æŠŠé‚„æ²’è¦ commit çš„ä¿®æ”¹å…ˆæ”¾åˆ° stash å»ï¼Œ
åœ¨åŸ·è¡Œå®Œ rebase ä¹‹å¾Œè‡ªå‹• pop å‡ºä¾†
ç„¶å¾Œè¨­å®šç‚º `alias`ï¼Œæ–¹ä¾¿å¿«é€Ÿ!

:::tip Git alias

```
alias.re=rebase -i --autostash --autosquash
```

:::

:::tip
è‡³æ–¼ç‚ºä»€éº¼è¦é€™æ¨£æ•´ç† commit?
å…¨éƒ¨ commit åœ¨ä¸€èµ·ä¸æ˜¯æ›´å¿«é€Ÿå—~?
æˆ‘è‡ªå·±çš„ç†ç”±æ˜¯: ç‚ºäº†ä¹‹å¾Œ `git revert` æ¯”è¼ƒæ–¹ä¾¿ï¼Œ
çœ‹ commit ä¸€æ¢ä¸€æ¢çœ‹ code é€™ç¨®äº‹æƒ…æˆ‘è‡ªå·±æ˜¯é‚„æ²’åšéå•¦ XD
ä½†æ˜¯åœ¨ revert ä¸Šå¾ˆæœ‰æ„Ÿï¼Œ
å¶çˆ¾æœƒé¢è‡¨åˆ°

- ä¸ç¢ºå®šé€™æ¨£å¯«å¥½ä¸å¥½
- å¯èƒ½é€™æ¬¡æ”¹äº†ï¼Œä¸‹æ¬¡é‚„è¦å†æ”¹å›ä¾†

çš„æƒ…æ³ï¼Œä¸Šè¿°é€™äº›æœ‰å¯èƒ½å°±æœƒç”¨åˆ° `git revert` ä¾†å¿«é€Ÿå›å¾©ï¼Œ
é€™æ™‚å€™ä¸€å€‹ commit éƒ½æ˜¯ç›¸é—œé‚è¼¯è€Œä¸”ç´°å°ï¼Œæ”¹å‹•èµ·ä¾†å°±æœƒéå¸¸æ–¹ä¾¿ã€‚
:::

## `git log --grep='message'`

ç”¨é€”: æ‰¾ç‰¹å®š title çš„ commit

message çš„éƒ¨åˆ†å¦‚æœåªæ˜¯"å–®è©"ï¼Œå¯ä»¥ä¸å¿…åŠ  `'` / `"`
å¦‚æœä¸­é–“é‚„æœ‰ç©ºç™½å°±å¿…é ˆåŠ ä¸Š `'` / `"`

åœ¨èŒ«èŒ« commit å¤§æµ·è£¡åƒè¬ä¸è¦ç”¨ç›®è¦–çš„ä¸€è¡Œä¸€è¡Œæ‰¾éå¾€çš„ commit å¶........

## `git branch -vv`

ç”¨é€”: åˆ—å‡ºç›®å‰ local branch å°æ‡‰åˆ° remote branch çš„ä½ç½®

![](./images/2022-01-14-02-17-48.png)

å¦‚ä¸Šåœ–ï¼Œç¾åœ¨ local branch çš„ main å°æ‡‰åˆ° remote branch çš„ origin/mainï¼Œ
è€Œä¸”é ˜å…ˆäº† 2 å€‹ commit é‚„æ²’è¢« pushï¼Œ
commit message çš„ title æ˜¯ "(anything): init 02 - git command"

## `git merge --no-ff --no-commit`

ç”¨é€”: merge æ™‚å¼·åˆ¶ä¸è¦ ff (Fast forward)ï¼Œä¹Ÿä¸è¦ç›´æ¥å°±æŠŠé è¨­çš„ merge message çµ¦ commit é€²å»ã€‚

å¦‚æœä½ çš„ commit ç¿’æ…£è·Ÿæˆ‘ä¸€æ¨£ **é›¶ç¢** çš„è©±ï¼Œ
å¥½åƒå¯ä»¥æ¡ç”¨çœ‹çœ‹?
ä¸ä½¿ç”¨ ff æ¨¡å¼å¯ä»¥åœ¨ commit æ”¯ç·šåœ–å¤šå‡ºä¸€æ¢ç·š
ç„¶å¾Œå†ç°¡å–®çš„æè¿°é€™å€‹**å€é–“**åšäº†ä»€éº¼äº‹æƒ…ï¼Œ
æˆ‘è¦ºå¾—æœ‰åŠ©æ–¼è‡ªå·±éäº†å¹¾å€‹ç¦®æ‹œå¾Œå›é ­çœ‹çœ‹è‡ªå·±åšäº†ä»€éº¼é€²åº¦ã€‚

(ä½†å¦‚æœå£“æ ¹ä¸æœƒæƒ³è¦å›é ­çœ‹çš„è©±ï¼Œé€™å€‹æ–¹å¼çµ•å°æ˜¯å¤šæ­¤ä¸€èˆ‰ ğŸ˜†)

![](./images/2022-01-14-03-24-27.png)

## git å…¶å¯¦æœ‰è‡ªå‹•è£œé½ŠæŒ‡ä»¤çš„åŠŸèƒ½

åƒæ˜¯ `git reset --hard`ï¼Œå…¶å¯¦å¯ä»¥ `git reset --h` å°±å¯ä»¥äº†ï¼Œ
åªè¦ git èƒ½æ‰¾åˆ°å–®ä¸€ç¬¦åˆçš„çµæœï¼Œå°±å¯ä»¥ä¸å¿…æŠŠå¾Œé¢çš„å­—å…¨éƒ¨æ‰“å®Œã€‚

---

ä¸‹é¢é€™é‚Šä¹Ÿæ˜¯é—œæ–¼ git æ“ä½œï¼Œä½†æ˜¯æ˜¯ä½¿ç”¨ vscode çš„ä»‹é¢ä¾†æ“ä½œã€‚

## Vscode command - `Git: Stage Selected Ranges`

![](./images/2022-01-14-02-24-25.png)

éå¾€æˆ‘æœƒä½¿ç”¨ `git add -p` æˆ–è€… `git add -i`
å»ç´°è†©çš„æŒ‘å‡ºæˆ‘é€™æ¬¡è¦ commit çš„å…§å®¹ï¼Œä½†å¾ˆéº»ç…©

ç›´æ¥ç”¨ vscode command ç›´æ¥æ¡†é¸ä½ è¦åŠ å…¥ staging çš„è¡Œæ•¸ï¼Œshift + ä¸Šä¸‹å·¦å³ã€æ»‘é¼ æ‹–æ›³é¸æ“‡...æ€æ¨£éƒ½å¥½
æ²’æœ‰åç™½å°±æœƒæ˜¯ å…‰æ¨™ æ‰€åœ¨çš„ä½ç½®

![](./images/2022-01-14-02-40-32.png)

(æˆ‘çš„ theme åç™½å¤ªä¸æ˜é¡¯ï¼Œå°±é€™å¼µæ›æˆç™½è‰²çš„ï¼Œé€™å¯ä¸æ˜¯ç›œåœ–å•Š)

ç„¶å¾ŒæŒ‰ä¸‹ `F1` (Show all command)ï¼ŒWindows å’Œ Mac é è¨­éƒ½æ˜¯ `F1`

:::tip è«‹åƒé–± keyboard ref
Mac: [https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf](https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf)

Windows: [https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf](https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf)
:::

è¼¸å…¥ 'git' æœƒçœ‹åˆ°
![](./images/2022-01-14-02-27-51.png)

é¸æ“‡ `Git: Stage Selected Ranges` çµ¦ä»– Enter ä¸‹å»

ä½ æ‰€é¸å–çš„ç¯„åœå°±åŠ é€² staging è£¡é¢äº†~~
**é€™å€‹è¶…ç´šç„¡æ•µå¥½ç”¨!! è«‹å–„ç”¨!!**

ç•¶ç„¶å…¶ä»–æœ‰å„å¼å„æ¨£ä¸Šç™¾ç¨® command ä¹Ÿå¯ä»¥è‡ªå·±ç©ç©çœ‹ï¼Œ
å°±ä¸ä¸€ä¸€ä»‹ç´¹äº†ï¼Œè¶…å¤šè¶…æ–¹ä¾¿é‚„ä¸å¿…è¨˜ keyboard shortcut!!
